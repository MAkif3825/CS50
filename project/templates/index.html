{% extends "layout.html" %}

{% block head %}

<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>


<script>
    document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
        eventTextColor: '#E6E6E6',
        initialView: 'dayGridMonth',
        dayMaxEvents: true,
        headerToolbar: {
            left: 'dayGridMonth,timeGridWeek listWeek', // Include your view options here
            center: 'title',
            right: 'prev,next today addEventButton'
        },

        eventClassNames: function(arg) {
            var classNames = [];

            // Check if the event is marked as done and add class accordingly
            if (arg.event.extendedProps.isDone) {
                classNames.push('done-event');
            }

            return classNames;
        },

        eventDidMount: function(info) {
            info.el.classList.add('fc-event-main');
        },


        events: {{ all|tojson|safe }},

        /*eventContent: function(info) {
            var eventContent = document.createElement('div');

            /* Create a checkbox if the event has a checkbox
            if (info.event.extendedProps.hasCheckbox) {
                var checkboxContainer = document.createElement('div');
                checkboxContainer.classList.add('checkbox-container');

                var checkbox = document.createElement('input');
                checkbox.type = 'checkbox';

                checkboxContainer.appendChild(checkbox);
                eventContent.appendChild(checkboxContainer);
            }

            // Add the event title
            var titleElement = document.createElement('div');
            titleElement.innerText = info.event.title;
            eventContent.appendChild(titleElement);

            return { domNodes: [eventContent] };
        }, */
        customButtons: {
            addEventButton: {
                text: 'Add',
                click: function() {
                    $('#addEventModal').modal('show');
                }
            }
        },
        timeZone: 'local'
    });
    calendar.render();
    calendar.setOption('height', 650);


        const eventTypeRadios = document.getElementsByName('eventType');
        const timeRangeFields = document.getElementById('timeRangeFields');

        for (const radio of eventTypeRadios) {
            radio.addEventListener('change', function() {
                if (radio.value === 'timeRange') {
                    timeRangeFields.style.display = 'block';
                } else {
                    timeRangeFields.style.display = 'none';
                }
            });
        }

        const taskTypeRadios = document.getElementsByName('taskType');
        const timeRangeeFields = document.getElementById('timeRangeeFields');
        for (const radio of taskTypeRadios) {
            radio.addEventListener('change', function() {
                if (radio.value === 'timeRangee') {
                    timeRangeeFields.style.display = 'block';
                } else {
                    timeRangeeFields.style.display = 'none';
                }
            });
        }

        const habitTypeRadios = document.getElementsByName('habitType');
        const timeRangeeeFields = document.getElementById('timeRangeeeFields');
        for (const radio of habitTypeRadios) {
            radio.addEventListener('change', function() {
                if (radio.value === 'timeRangeee') {
                    timeRangeeeFields.style.display = 'block';
                } else {
                    timeRangeeeFields.style.display = 'none';
                }
            });
        }
    });
</script>

{% endblock %}

{% block title %}
    Homepage
{% endblock %}

{% block main %}
<div class="grid m-3 border rounded-3 bg-white bg-opacity-10">
    <div class="row align-items-start">
        <div class="avatar rounded-circle justify-content-center offset align-items-start m-2 ms-2 col-auto">
            <img src="/static/pp/{{user['pp_img']}}" alt="Profile Picture" class="rounded-circle border"  style="width: 75px; background-color: {{user['pp_bg']}}">
        </div>
        <div class="col-auto">
            <h2 class="col text-start">
               {{user['name']}} {{user['surname']}}
            </h2>
            <div class="row text-start">
                <p> Today: {{today}}</p>
            </div>
        </div>
        <div class="col-auto row align-items-start col-offset-4 justify-content-between">
            <a class="nav-link col-auto" href="/settings"><i class="bi bi-gear-wide" style="font-size: 2rem; color: white;"></i></a>
            <a class="nav-link col-auto" href="/logout"><i class="bi bi-box-arrow-right p-1" style="font-size: 2rem; color: white;"></i></a>
        </div>
    </div>
</div>

<!-- Bootstrap Modal -->
<div class="modal fade" id="addEventModal" tabindex="-1" aria-labelledby="addEventModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalLabel">Add</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                    <li class="nav-item" role="presentation">
                      <button class="nav-link active" id="pills-event-tab" data-bs-toggle="pill" data-bs-target="#pills-event" type="button" role="tab" aria-controls="pills-event" aria-selected="true">Event</button>
                    </li>
                    <li class="nav-item" role="presentation">
                      <button class="nav-link" id="pills-task-tab" data-bs-toggle="pill" data-bs-target="#pills-task" type="button" role="tab" aria-controls="pills-task" aria-selected="false">Task</button>
                    </li>
                    <li class="nav-item" role="presentation">
                      <button class="nav-link" id="pills-habit-tab" data-bs-toggle="pill" data-bs-target="#pills-habit" type="button" role="tab" aria-controls="pills-habit" aria-selected="false">Habit</button>
                    </li>
                </ul>
                <div class="tab-content" id="pills-tabContent">
                    <div class="tab-pane fade show active" id="pills-event" role="tabpanel" aria-labelledby="pills-event-tab" tabindex="0">
                        <form id="eventForm" action="/add_event" method="post">
                            <div class="mb-3">
                                <div class="mb-3 row">
                                    <div class="col-auto">
                                        <label for="title" class="form-label">Event Title</label>
                                        <input type="text" class="form-control" id="title" name="title" required>
                                    </div>
                                    <div class="col-auto">
                                        <label for="title" class="form-label">Background Color</label>
                                        <input type="color" name="backgroundColor1" class="form-control form-control-color" id="color" value="#563d7c" title="Choose your color">
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3 row">
                                <div class="col-6">
                                    <label for="start" class="form-label">Start Date</label>
                                    <input type="date" class="form-control" id="start" name="start" required>
                                </div>

                                <div class="col-6">
                                    <label for="end" class="form-label">End Date</label>
                                    <input type="date" class="form-control" id="end" name="end" required>
                                </div>
                            </div>
                            <div class="m-3 row">
                                <div class="col-auto">
                                    <label for="timee" class="form-label">Time Range:  </label>
                                </div>
                                <div class="col-auto">
                                    <label> <input type="radio" id="time" name="eventType" value="allDay"> All Day </label>
                                </div>
                                <div class="col-auto">
                                    <label> <input type="radio" id="timee" name="eventType" value="timeRange"> Specify Time Range </label>
                                </div>
                            </div>
                            <div  class="m-3 row">
                                <div id="timeRangeFields"  style="display: none;">
                                    <div class="col-auto m-2">
                                        <label> Start Time: <input type="time" name="startTime"> </label>
                                    </div>
                                    <div class="col-auto m-2">
                                        <label> End Time: <input type="time" name="endTime"> </label>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">Add Event</button>
                            </div>
                        </form>
                    </div>


                    <div class="tab-pane fade" id="pills-task" role="tabpanel" aria-labelledby="pills-task-tab" tabindex="0">
                        <form id="eventForm" action="/add_task" method="post">
                            <div class="mb-3">
                                <div class="mb-3 row">
                                    <div class="col-auto">
                                        <label for="title" class="form-label">Task Title</label>
                                        <input type="text" class="form-control" id="title" name="title" required>
                                    </div>
                                    <div class="col-auto">
                                        <label for="title" class="form-label">Background Color</label>
                                        <input type="color" class="form-control form-control-color" id="color" name="backgroundColor2" value="#563d7c" title="Choose your color">
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3 row">
                                <div class="col-6">
                                    <label for="start" class="form-label">Start Date</label>
                                    <input type="date" class="form-control" id="start" name="start" required>
                                </div>

                                <div class="col-6">
                                    <label for="end" class="form-label">End Date</label>
                                    <input type="date" class="form-control" id="end" name="end" required>
                                </div>
                            </div>
                            <div class="m-3 row">
                                <div class="col-auto">
                                    <label for="timee" class="form-label">Time Range:  </label>
                                </div>
                                <div class="col-auto">
                                    <label> <input type="radio" id="time" name="taskType" value="allDay"> All Day </label>
                                </div>
                                <div class="col-auto">
                                    <label> <input type="radio" id="timee" name="taskType" value="timeRangee"> Specify Time Range </label>
                                </div>
                            </div>
                            <div  class="m-3 row">
                                <div id="timeRangeeFields"  style="display: none;">
                                    <div class="col-auto m-2">
                                        <label> Start Time: <input type="time" name="startTimee"> </label>
                                    </div>
                                    <div class="col-auto m-2">
                                        <label> End Time: <input type="time" name="endTimee"> </label>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">Add Task</button>
                            </div>
                        </form>
                    </div>
                    <div class="tab-pane fade" id="pills-habit" role="tabpanel" aria-labelledby="pills-habit-tab" tabindex="0">
                        <form id="eventForm" action="/add_habit" method="post">
                            <div class="mb-3">
                                <div class="mb-3 row">
                                    <div class="col-auto">
                                        <label for="title" class="form-label">Habit Title</label>
                                        <input type="text" class="form-control" id="title" name="title" required>
                                    </div>
                                    <div class="col-auto">
                                        <label for="title" class="form-label">Background Color</label>
                                        <input type="color" name="backgroundColor3" class="form-control form-control-color" id="color" value="#563d7c" title="Choose your color">
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3 row">
                                <div class="col-6">
                                    <label for="start" class="form-label">Start Date</label>
                                    <input type="date" class="form-control" id="start" name="start" required>
                                </div>

                                <div class="col-6">
                                    <label for="end" class="form-label">End Date</label>
                                    <input type="date" class="form-control" id="end" name="end" required>
                                </div>
                            </div>
                            <label for="days"> Days:</label>
                            <div class="row ms-3" id="days">
                                <div class="col-auto m-3">
                                    <input type="checkbox" id="monday" name="days" value="1">
                                    <label for="monday"> Monday</label>
                                </div>
                                <div class="col-auto m-3">
                                    <input type="checkbox" id="tuesday" name="days" value="2">
                                    <label for="tuesday"> Tuesday</label>
                                </div>
                                <div class="col-auto m-3">
                                    <input type="checkbox" id="wednesday" name="days" value="3">
                                    <label for="wednesday"> Wednesday</label>
                                </div>
                                <div class="col-auto m-3">
                                    <input type="checkbox" id="thursday" name="days" value="4">
                                    <label for="thursday"> Thursday</label>
                                </div>
                                <div class="col-auto m-3">
                                    <input type="checkbox" id="friday" name="days" value="5">
                                    <label for="friday"> Friday</label>
                                </div>
                                <div class="col-auto m-3">
                                    <input type="checkbox" id="saturday" name="days" value="6">
                                    <label for="saturday"> Saturday</label>
                                </div>
                                <div class="col-auto m-3">
                                    <input type="checkbox" id="sunday" name="days" value="0">
                                    <label for="sunday"> Sunday</label>
                                </div>
                            </div>
                            <div class="m-3 row">
                                <div class="col-auto">
                                    <label for="timee" class="form-label">Time Range:  </label>
                                </div>
                                <div class="col-auto">
                                    <label> <input type="radio" id="time" name="habitType" value="allDay"> All Day </label>
                                </div>
                                <div class="col-auto">
                                    <label> <input type="radio" id="timee" name="habitType" value="timeRangeee"> Specify Time Range </label>
                                </div>
                            </div>
                            <div  class="m-3 row">
                                <div id="timeRangeeeFields"  style="display: none;">
                                    <div class="col-auto m-2">
                                        <label> Start Time: <input type="time" name="startTimeee"> </label>
                                    </div>
                                    <div class="col-auto m-2">
                                        <label> End Time: <input type="time" name="endTimeee"> </label>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">Add Habit</button>
                            </div>
                        </form>
                    </div>
                </div>




                <!--<form id="eventForm" action="/add_event" method="post">
                    <div class="mb-3">
                        <div class="mb-3 row">
                            <div class="col-auto">
                                <label for="title" class="form-label">Event Title</label>
                                <input type="text" class="form-control" id="title" name="title" required>
                            </div>
                            <div class="col-auto">
                                <label for="title" class="form-label">Background Color</label>
                                <input type="color" class="form-control form-control-color" id="color" value="#563d7c" title="Choose your color">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <div class="col-6">
                            <label for="start" class="form-label">Start Date</label>
                            <input type="date" class="form-control" id="start" name="start" required>
                        </div>

                        <div class="col-6">
                            <label for="end" class="form-label">End Date</label>
                            <input type="date" class="form-control" id="end" name="end" required>
                        </div>
                    </div>
                    <div class="m-3 row">
                        <div class="col-auto">
                            <label for="timee" class="form-label">Time Range:  </label>
                        </div>
                        <div class="col-auto">
                            <label> <input type="radio" id="time" name="eventType" value="allDay"> All Day </label>
                        </div>
                        <div class="col-auto">
                            <label> <input type="radio" id="timee" name="eventType" value="timeRange"> Specify Time Range </label>
                        </div>
                    </div>
                    <div  class="m-3 row">
                        <div id="timeRangeFields"  style="display: none;">
                            <div class="col-auto m-2">
                                <label> Start Time: <input type="time" name="startTime"> </label>
                            </div>
                            <div class="col-auto m-2">
                                <label> End Time: <input type="time" name="endTime"> </label>
                            </div>
                        </div>
                    </div>
                    <div class="m-3 row">
                        <div class="col-auto">
                            <label for="type" class="form-label">Type:  </label>
                        </div>
                        <div class="col-auto">
                            <label> <input type="radio" id="type" name="eventTypee" value="allDay"> All Day </label>
                        </div>
                        <div class="col-auto">
                            <label> <input type="radio" id="timee" name="eventType" value="timeRange"> Specify Time Range </label>
                        </div>
                    </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary">Add Event</button>
                        </div>
                </form>-->
            </div>
        </div>
    </div>
</div>

<div class="row m-3 ">
    <div class="grid border rounded-3 bg-white bg-opacity-10 col-8">
        <div id="calendar" class="p-3"></div>
    </div>

    <div class="grid border ms-3 rounded-3 bg-white bg-opacity-10 col">
        <h3 class="pt-2"> Today</h3>
        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th class="col-2">Num</th>
                    <th class="col"> Event Name </th>
                </tr>
            </thead>
            <tbody>
                {% for event in events %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ event["title"] }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th class="col-2">Num</th>
                    <th class="col"> Task Name </th>
                    <th class="col"> Status </th>
                </tr>
            </thead>
            <tbody>
                {% for task in tasks %}
                <tr {% if task["status"] == 'true' %} class="done-event" {% endif %}>
                        <td>{{ loop.index }}</td>
                        <td>{{ task["title"] }}</td>
                        <td>
                            <form action="/task_status" method="post">
                                {% if task["status"] == "false" %}
                                    <input type="hidden" name="task_status" value="true">
                                    <input type="hidden" name="task_id" value={{task['task_id']}}>
                                    <input type="submit" value="Mark as done" style="background-color: green; color: white;">
                                {% else %}
                                    <input type="hidden" name="task_status" value="false">
                                    <input type="hidden" name="task_id" value={{task['task_id']}}>
                                    <input type="submit" value="Mark as not done" style="background-color: blue; color: white;">
                                {% endif %}
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th class="col-2">Num</th>
                    <th class="col"> Habit Name </th>
                    <th class="col"> Repetiton </th>
                    <th class="col"> Status </th>
                </tr>
            </thead>
            <tbody>
                {% for habit in habits %}
                    <tr {% if habit["status"] == 'true' %} class="done-event" {% endif %}>
                        <td>{{ loop.index }}</td>
                        <td>{{ habit["title"] }}</td>
                        <td>{{ habit["habit_day"] }}</td>
                        <td>
                            <form action="/habit_status" method="post">
                                {% if habit["status"] == "false" %}
                                    <input type="hidden" name="habit_status" value="true">
                                    <input type="hidden" name="habit_id" value={{habit['habit_id']}}>
                                    <input type="hidden" name="start" value={{habit['start']}}>
                                    <input type="submit" value="Mark as done"style="background-color: green; color: white;">
                                {% else %}
                                    <input type="hidden" name="habit_status" value="false">
                                    <input type="hidden" name="habit_id" value={{habit['habit_id']}}>
                                    <input type="hidden" name="start" value={{habit['start']}}>
                                    <input type="submit" value="Mark as not done" style="background-color: blue; color: white;">
                                {% endif %}
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}